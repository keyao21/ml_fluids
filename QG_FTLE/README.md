# QG_FTLE 

The goal of this project is to generate __Finite time Lyapunov exponent__ (FTLE) fields from fluid dynamics time series data. The immediate use case is to compare actual and estimated time series data from machine learning models.

Specifically, _stream function field time series data_ is placed in the __./inputs/__ directory. These files are usually 3 dimensional numpy arrays with size (x, y, t). 

_Velocity field time series data_ is calculated from the stream function field data, and _velocity field functions_ are generated by interpolating the fields at each time step in the velocity field time series data. 

_FTLE_ fields are calculated using the _velocity field functions__ using RK4 interpolation. 

## Set up

The following command at the root should set up the necessary directories

```bash
python setup_dir.py
```

## Demos 

There are scripts set up to run Double Gyre and Quasi Geo Model experiments. Configurations for the experiements are set in __./src/config.py__ as a python dictionary named CONFIG. 


The full experiment consists of the following steps: 
1. Read in stream function field data and calculate velocity field data 
2. Generate velocity functions from velocity field data
3. Generate FTLE mapping files 
4. Generate FTLE field files and animations

for _both_ the actual and estimated stream function field time series data. 

### Double Gyre Experiment

In the __./inputs/__ directory, there should be actual and estimated stream function field time series data. The filenames should correspond to the filenames in the following config values: 

```python
CONFIG['DOUBLE_GYRE_ACTUAL']
CONFIG['DOUBLE_GYRE_EST']
```

To run a full double gyre demo experiment, run the following command: 

```bash
python dg_demo.py
```

### Quasi Geostrophic Model Experiment

In the __./inputs/__ directory, there should be actual and estimated stream function field time series data. The filenames should correspond to the filenames in the following config values: 

```python
CONFIG['QUASIGEO_ACTUAL']
CONFIG['QUASIGEO_EST']
```

To run a full QG demo experiment, run the following command: 

```bash
python qg_demo.py
```

## Results 

Results are currently stored in __./results__. This directory probably needs to be better organized, but for now, all outputs are stored here.  


## Tests

There are some unit tests modules currently in __./src__. To run them all, execute the following command at the root directory: 

```bash
python -m unittest discover -v
```

Note that sometimes ```test_interp.py``` will fail, just run it a couple times. Currently, the interpolation methodology to generate velocity functions from the discrete velocity field time series data does not handle the boundaries of the field well, so testing velocity field values near the boundaries will often yield poor results. 

